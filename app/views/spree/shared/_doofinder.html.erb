<%
  search_zone = Rails.configuration.x.doofinder.search_zone
  api_key = Rails.configuration.x.doofinder.api_key
  hashid = Rails.configuration.x.doofinder.hashid
%>
<!-- Doofinder autocomplete -->
<script type="text/javascript">
  $(document).on('turbolinks:load', function() {
    var options = {
      url: function(keywords) {
        return "https://<%= search_zone %>-search.doofinder.com/5/suggest?hashid=<%= hashid %>&query=" + encodeURIComponent(keywords) + "&type=product&page=1&rpp=10";
      },
      ajaxSettings: {
        dataType: "json",
        headers: {
          "Authorization": "<%= api_key %>"
        },
      },
      getValue: "term",
      listLocation: "results",
      requestDelay: 200,
      list: {
        maxNumberOfElements: 10,
        onClickEvent: function() {
          $("#global-search-button").submit()
        },
        onKeyEnterEvent: function() {
          $("#global-search-button").submit()
        },
      }
    };

    $('#keywords').easyAutocomplete(options);
    
    $('#keywords').keypress(function(e) {
      if (e.key === 'Enter' || e.keyCode === 13) {
        $("#global-search-button").submit()
      }
    });
  });
</script>