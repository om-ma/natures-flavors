<div id="shipping-method" data-hook>
  <ol class="breadcrumb mb-20">
    <li class="breadcrumb-item"><%= link_to "Cart", cart_path, title: "Cart" %></li>
    <li class="breadcrumb-item"><a href="/checkout/address" data-turbolinks="false">Address</a></li>
    <li class="breadcrumb-item">Shipping</li>
    <li class="breadcrumb-item">Payment</li>
  </ol>
  <div id="methods" data-turbolinks="false"> 
    <%= form.fields_for :shipments do |ship_form| %>
      <div class="address-shipping-wrap" data-hook="shipping_method_inner" >
        <div class="address-wrap" id="shipToLocation">
          <%= checkout_edit_link %>
          <h5>Address</h5>
          <%= render 'spree/shared/address', address: @order.ship_address %>
        </div>
      </div>
      <div class="cart-header d-flex align-items-center justify-content-between mb-0">
        <h5>Shipping</h5>
      </div>
      <ul class="shipping-options">
        <%
          sorted_shipping_rates = sort_shipping_rates_local_pickup_last(ship_form.object.shipping_rates) 
          sorted_shipping_rates.each do |rate|
        %>
          <li>
            <div class="custom-radio">
              <label>
                <%= ship_form.radio_button :selected_shipping_rate_id,
                rate.id,
                data: {
                  behavior: 'shipping-method-selector',
                  cost: rate.display_cost,
                  tax: rate.display_tax_amount
                }, class: 'custom-control-input' %>
                <span class="custom-control-label"></span><%= rate.name %></label>
            </div>
            <div class="shipping-price"><%= rate.display_cost %></div>
          </li>
        <% end %>
      </ul>
      <% if sorted_shipping_rates.count == 1 && sorted_shipping_rates[0].shipping_method.calculator.class.name == "Spree::Calculator::Shipping::LocalPickupCalculator" %>
      <p>This order exceeds the standard weight limit.<br/>For custom shipping rates, contact us at <a href="tel:1-714-744-3700">1-714-744-3700</a> or email us at <a href="mailto:customerservice@naturesflavors.com" target="_blank" alt="ailto:customerservice@naturesflavors.com">customerservice@naturesflavors.com</a>.</p>
      <% end %>
    <% end %>
    <% if Spree::Config[:shipping_instructions] %>
    <div id="faqaccordion" class="shipping-accordion">
      <div id="minstrs" class="shipping-instructions" data-hook>
        <button type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true">Add Shipping Instructions</button>
        <div id="collapseTwo" class="collapse" data-parent="#faqaccordion" style="">
          <%= form.text_area :special_instructions, cols: 40, rows: 2, class: "form-control" %>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>
<button type="button" class="btn btn-primary btn-block design-submit-next-step" >Next Step: <strong>Payment</strong></button>