<% @body_id = 'checkout-page' %>
<%
content_for :head do
  agent = request.env['HTTP_USER_AGENT']
  if agent =~ /Safari/ && !(agent =~ /Chrome/)
%>
  <script>
    if (!!window.performance && window.performance.navigation.type === 2) {
      window.location.reload();
    }
    window.onpageshow = function(event) {
      if (event.persisted) {
        window.location.reload()
      }
    }
  </script>
<%
  end
end
%>
<div data-hook="checkout_header"  ></div>
<main class="page-contents" id="checkout" data-hook >
  <div class="checkout-wrapper" data-hook="checkout_title">
    <%= form_for @order, url: spree.update_checkout_path(@order.state), html: { id: "checkout_form_#{@order.state}", class: "" } do |form| %>
      <div class="row flex-row-reverse no-gutters" data-hook="checkout_progress" data-hook="checkout_content">
        <div class="col-lg-6">
          <div class="mobile-cart-summary-header phone-visible">
            <h4>My Cart / <%= @order.display_total.to_html %></h4>
           <button type="button" class="show-cart-summary"><span>Show</span></button>
          </div>
          <div class="wrap mobile-cart-summary d-flex flex-column justify-content-between h-100">
            <% unless @order.confirm? %>
              <%= render partial: 'summary', locals: { order: @order, order_form: form } %>
              <div data-hook="buttons" class="d-none">
                <% submit_label_key = @order.confirm? ? :place_order : :save_and_continue %>
                <%= submit_tag Spree.t(submit_label_key), class: 'btn btn-primary btn-block checkout-content-save-continue-button', id:'checkout-submit-to-next-step' %>
              </div>
            <% end %>
          </div>
        </div>
        <div class="<%= if @order.state != 'confirm' then 'col-lg-6'  end %>" data-hook="checkout_form_wrapper">
          <div class="wrap">
            <%= form.hidden_field :state_lock_version %>
            <%= render @order.state, form: form %>
          </div>
        </div>
      </div>
      <div class="cart-icon phone-hide"></div>
    </div>
  <% end %>
</main>
